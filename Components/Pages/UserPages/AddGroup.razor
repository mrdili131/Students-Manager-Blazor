@page "/User/AddGroup"
@rendermode InteractiveServer
@using Bogcha.Data
@using Bogcha.Models
@inject Bogcha.Data.BogchaDbContext DbContext
@using Microsoft.EntityFrameworkCore

<div class="main-container">
    <div class="top-bar">
      <h1>Yangi guruh qo‘shish</h1>
    </div>

    <div class="form-container">
      <div class="form-group">
        <label for="group-name">Gruppa nomi</label>
        <input type="text" @bind="newGroup.Name" id="group-name" placeholder="Masalan: Katta Guruh F48" />
      </div>

      <div class="form-group">
        <label for="teacher">Tarbiyachi (foydalanuvchi) tanlang</label>
        <select id="teacher" @bind="newGroup.TeacherId">
          <option value="">Tanlang...</option>
          @foreach(var user in Users){
            <option value="@user.Id">@user.LastName @user.FirstName</option>
          }
        </select>
      </div>

      <div class="form-group">
        <label for="type">Bog‘chani tanlang</label>
        <select id="type" @bind="newGroup.BogchaId">
          <option value="">Tanlang...</option>
          @foreach(var bogcha in Bogchas){
            <option value="@bogcha.Id">@bogcha.Name</option> 
          }
        </select>
      </div>

      <button class="submit-btn" @onclick="SaveGroup">Saqlash</button>
    </div>
  </div>


@code{
    List<User> Users = new List<User>();
    List<BogchaModel> Bogchas = new List<BogchaModel>();

    Group newGroup = new Group();

    protected override async Task OnInitializedAsync(){
        Users = await DbContext.Users.ToListAsync();
        Bogchas = await DbContext.Bogchas.ToListAsync();
    }

    private async Task SaveGroup(){
        if (
            !string.IsNullOrWhiteSpace(newGroup.Name)
            && newGroup.BogchaId != null
            && newGroup.TeacherId != null
            )
        {
            DbContext.Groups.Add(newGroup);
            newGroup = new Group();
            await DbContext.SaveChangesAsync();
        }
    }
}